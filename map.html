---
title: Festival of Neighbourhoods
layout: default
css:
  - map.css
---
<div class="map-container">
  <div id="map"></div>
</div>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="../data/registered.js"></script>
<script src="../data/unregistered.js"></script>
<script src="../data/wards.js"></script>
<script src="../data/grants.js"></script>
<script>

// Map

var map = L.map('map').setView([43.43,-80.46], 12);
  L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
  id: 'examples.map-i875mjb7'
}).addTo(map);

// Ward Boundaries

function wardColour(w) {
  return w == 10 ? '#ffffb3' :
         w == 9  ? '#bebada' :
         w == 8  ? '#fb8072' :
         w == 7  ? '#80b1d3' :
         w == 6  ? '#fdb462' :
         w == 5  ? '#b3de69' :
         w == 4  ? '#fccde5' :
         w == 3  ? '#d9d9d9' :
         w == 2  ? '#bc80bd' :
         w == 1  ? '#8dd3c7' :
                   '#ccebc5' ;
}

function wardStyle(feature) {
  return {
    weight: 1,
    opacity: .5,
    color: '#000',
    fillOpacity: 0.4,
    fillColor: wardColour(feature.properties.WardNumber)
  };
}

function onEachWard(feature, layer) {
  polygonCentre = layer.getBounds().getCenter();
  myIcon = L.divIcon({
    className: 'wardLabel',
    html: feature.properties.WardName,
    iconSize: new L.Point(58,20)
  });
  L.marker(polygonCentre, {icon: myIcon}).addTo(map);
}

var wards = L.geoJson(wardBoundaries, {
  onEachFeature: onEachWard,
  style: wardStyle
}).addTo(map);

// Activities

function placeStyle(feature){
  return {
    weight: 2,
    opacity: 1,
    color: 'white',
    dashArray: '3',
    fillOpacity: 0.6,
    fillColor: 'white'
  };
}

function onEachPlace(feature, layer) {
  var activity_count = feature.properties.activities.length;
  var activity_list = '<h3>' + feature.properties.neighbourhood + '</h3><ul>';
  for(var i=0; i < activity_count; i++) {
    activity_list += '<li>' + feature.properties.activities[i].activity + '</li>';
  }
  activity_list += '</ul>';
  layer.bindPopup(activity_list)
  /*
  myIcon = L.divIcon({
    className: 'my-div-icon',
    html: activity_count,
    iconSize: new L.Point(20,20)
  });
  layer.setIcon(myIcon);
  */
}
 
var registered_geo = L.geoJson(registered, {
  onEachFeature: onEachPlace,
  pointToLayer: function (feature, latlng) {
    return L.circleMarker(latlng, {
      radius: 10 + (feature.properties.activities.length * 2),
      fillColor: "blue",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 0.5
    });
  }

});
map.addLayer(registered_geo);

var unregistered_geo = L.geoJson(unregistered, {
  onEachFeature: onEachPlace,
  pointToLayer: function (feature, latlng) {
    return L.circleMarker(latlng, {
      radius: 10 + (feature.properties.activities.length * 2),
      fillColor: "#ccc",
      color: "blue",
      weight: 1,
      opacity: 1,
      fillOpacity: 0.3
    });
  }

});

var grants_geo = L.geoJson(grants, {
  onEachFeature: function (feature, layer) {
    var g_count = feature.properties.grants.length;
    var g_info = '';
    for(var i=0; i < g_count; i++) {
      g_info += '<h3>' + feature.properties.grants[i].year + '</h3>';
      g_info += '<p>' + feature.properties.grants[i].neighbourhood + ': ';
      g_info += feature.properties.grants[i].description + '</p>';
    }
    layer.bindPopup(g_info)
  }
});

var overlays = {
  "Registered Activities": registered_geo,
  "Unregistered Activities": unregistered_geo,
  "Capital Grants": grants_geo,
  "Kitchener Wards": wards
};

L.control.layers(null, overlays, {collapsed: false, position: 'bottomright'}).addTo(map);

</script>
