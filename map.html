---
title: Map
layout: default
selected: map
css:
  - "http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"
  - "/festival-of-neighbourhoods/style/MarkerCluster.css"
  - "/festival-of-neighbourhoods/style/MarkerCluster.Default.css"
  - "/festival-of-neighbourhoods/style/leaflet.awesome-markers.css"
  - "/festival-of-neighbourhoods/style/map.css"
---
<div class="map-container">
  <div id="map"></div>
</div>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="../js/leaflet.markercluster.js"></script>
<script src="../js/leaflet.awesome-markers.js"></script>
<script src="../data/registered.js"></script>
<script src="../data/unregistered.js"></script>
<script src="../data/registered-2016.js"></script>
<script src="../data/unregistered-2016.js"></script>
<script src="../data/registered-2015.js"></script>
<script src="../data/unregistered-2015.js"></script>
<script src="../data/wards.js"></script>
<script src="../data/grants.js"></script>
<script>

// Map

var map = L.map('map').setView([43.43,-80.46], 12);
  L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
  maxZoom: 16,
  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

// Ward Boundaries 

function wardColour(w) {
  return w == 10 ? '#ffffb3' :
         w == 9  ? '#bebada' :
         w == 8  ? '#fb8072' :
         w == 7  ? '#80b1d3' :
         w == 6  ? '#fdb462' :
         w == 5  ? '#b3de69' :
         w == 4  ? '#fccde5' :
         w == 3  ? '#d9d9d9' :
         w == 2  ? '#bc80bd' :
         w == 1  ? '#8dd3c7' :
                   '#ccebc5' ;
}

function wardStyle(feature) {
  return {
    weight: 1,
    opacity: .5,
    color: '#000',
    fillOpacity: 0.4,
    fillColor: wardColour(feature.properties.WardNumber)
  };
}

function onEachWard(feature, layer) {
  polygonCentre = layer.getBounds().getCenter();
  myIcon = L.divIcon({
    className: 'wardLabel',
    html: feature.properties.WardName,
    iconSize: new L.Point(58,20)
  });
  L.marker(polygonCentre, {icon: myIcon}).addTo(map);
}

var wards = L.geoJson(wardBoundaries, {
  onEachFeature: onEachWard,
  style: wardStyle
}).addTo(map);

// Activities

function onEachPlace(feature, layer) {
  var activity = '<h3>' + feature.properties.neighbourhood + '</h3>';
  activity += '<h4>' + feature.properties.activity.activity + ' ';
  activity += '(' + feature.properties.activity.date + ')</h4>';
  if (feature.properties.activity.quote != '') {
    activity += '<p>"' + feature.properties.activity.quote + '"</p>';
  }
  layer.bindPopup(activity)
}

function onEachPlaceUnReg(feature, layer) {
  var activity = '<h3>' + feature.properties.neighbourhood + '</h3>';
  activity += '<h4>' + feature.properties.activity.activity + ' ';
  activity += '(' + feature.properties.activity.date + ')</h4>';
  activity += '<p>Unregistered activity. <a href="http://www.waterlooregion.org/festival-of-neighbourhoods-registration-short">Register now</a>!</p>';
  layer.bindPopup(activity)
}

var regIcon = L.AwesomeMarkers.icon({
  prefix: 'fa',
  markerColor: 'blue',
  icon: 'group'
});

var unregIcon = L.AwesomeMarkers.icon({
  prefix: 'fa',
  markerColor: 'red',
  icon: 'group'
});

var grantIcon = L.AwesomeMarkers.icon({
  prefix: 'fa',
  markerColor: 'purple',
  icon: 'trophy'
});

// Current Activities
var markers = L.markerClusterGroup({
  maxClusterRadius: 20
});

var registered_geo = L.geoJson(registered, {
  onEachFeature: onEachPlace,
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: regIcon
    });
  }
});
markers.addLayer(registered_geo);

var unregistered_geo = L.geoJson(unregistered, {
  onEachFeature: onEachPlaceUnReg,
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: unregIcon
    });
  }
});
markers.addLayer(unregistered_geo);

map.addLayer(markers);

// 2016 Activities

var markers2016 = L.markerClusterGroup({
  maxClusterRadius: 20
});

var registered_2016 = L.geoJson(registered2016, {
  onEachFeature: onEachPlace,
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: regIcon
    });
  }
});
markers2016.addLayer(registered_2016);

var unregistered_2016 = L.geoJson(unregistered2016, {
  onEachFeature: onEachPlaceUnReg,
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: unregIcon
    });
  }
});
markers2016.addLayer(unregistered_2016);

// 2015 Activities

var markers2015 = L.markerClusterGroup({
  maxClusterRadius: 20
});

var registered_2015 = L.geoJson(registered2015, {
  onEachFeature: onEachPlace,
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: regIcon
    });
  }
});
markers2015.addLayer(registered_2015);

var unregistered_2015 = L.geoJson(unregistered2015, {
  onEachFeature: onEachPlaceUnReg,
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: unregIcon
    });
  }
});
markers2015.addLayer(unregistered_2015);

// Grants

var grants_geo = L.geoJson(grants, {
  onEachFeature: function (feature, layer) {
    var g_count = feature.properties.grants.length;
    var g_info = '';
    for(var i=0; i < g_count; i++) {
      g_info += '<h3>' + feature.properties.grants[i].year + ' Capital Grant</h3>';
      g_info += '<p>' + feature.properties.grants[i].neighbourhood + ': ';
      g_info += feature.properties.grants[i].description + '</p>';
    }
    layer.bindPopup(g_info)
  },
  pointToLayer: function (feature, latlng) {
    return L.marker(latlng, {
      icon: grantIcon
    });
  }
});

map.addLayer(grants_geo);

// Map controls

var bases = {
  "2017": markers,
  "2016": markers2016,
  "2015": markers2015
}

var overlays = {
  "Capital Grants": grants_geo,
  "Kitchener Wards": wards
};

L.control.layers(bases, overlays, {collapsed: false, position: 'bottomright'}).addTo(map);

</script>
